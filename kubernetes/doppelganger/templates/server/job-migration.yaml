apiVersion: batch/v1
kind: Job
metadata:
  name: django-migrations
spec:
  template:
    spec:
      containers:
        - name: django
          image: {{ .Values.django.image }}
          command:
            - /bin/bash
            - -c
            - |
              python manage.py migrate &&
              python manage.py graphql_schema
          {{- include "doppelganger.djangoStandardEnv" . | nindent 10 }}
      restartPolicy: Never
      imagePullSecrets:
        - name: gcr-json-key
  backoffLimit: 5
